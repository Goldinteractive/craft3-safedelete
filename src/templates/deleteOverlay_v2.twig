{% macro outputElementType(id) %}
{% spaceless %}
    {% set type = craft.app.elements.getElementTypeById(id)|split('\\') %}
    {{ type|last }}
{% endspaceless %}
{% endmacro %}

{% import _self as macros %}

<div class="body" style="overflow-y: auto; max-height: 100%;">
    <form method="post">
        <div class="main">
            <div class="main">
                <h2>{{ 'Element is still referenced'|t }}</h2>
                <div class="description">{{ 'The selected element is still in use and can not be deleted just like that.'|t }}</div>
                <div class="elements">
                    <table class="data fullwidth">
                        <thead>
                        <tr>
                            <th scope="col">
                                {{ 'Site'|t }}
                            </th>
                            <th scope="col">
                                {{ 'Source Element'|t }}
                            </th>
                            <th scope="col">
                                {{ 'Reference element type'|t }}
                            </th>
                            <th scope="col">
                                {{ 'Field'|t }}
                            </th>
                            <th scope="col">
                                {{ 'Title'|t }}
                            </th>
                            <th scope="col">
                                {{ 'Slug'|t }}
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for elements in relations %}
                            {% for sourceElement in elements %}
                                {% for result in sourceElement.results %}
                                <tr>
                                    <td>{{ result.siteName ?? 'No site - check it' }}</td>
                                    <td>{{ sourceElement.sourceElementTitle ?? 'No element - check it' }}</td>

                                    <td>{{ result.elementType|t }}</td>
                                    <td>{{ result.fieldName }} ({{ result.fieldHandle }})</td>
                                    <td>
                                        {{ result.elementTitle }}                               
                                    </td>
                                    <td>{{ sourceElement.sourceElementSlug ?? 'No slug - check it' }}</td>
                                </tr>
                                {% endfor %}
                            {% endfor %}
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% if allowForceDelete %}
                    <p style="margin-top: 20px;">
                        <input type="button" class="btn submit" name="forceDelete" value="{{ 'Delete all elements'|t }}">
                    </p>
                    <p style="margin-top: 10px;">{{ 'WARNING! Deletion of referenced elements can lead to unexpected consequences and errors in the frontend.'|t }}</p>
                {% endif %}
            </div>
        </div>
        <div class="buttons left">
            <input type="button" class="btn reload" value="{{ 'Reload'|t }}"/>
        </div>
        <div class="buttons right">
            <input type="button" class="btn cancel" value="{{ 'Cancel'|t }}">
            <input type="button" class="btn submit" name="deleteUnreferencedElements"
                   value="{{ 'Delete unreferenced elements'|t }}">
        </div>
    </form>
</div>
